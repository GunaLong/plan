<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/loginstyle.css" />
    <link rel="stylesheet" href="../css/media.css">
    <script src="../js boostrap/jquery-3.6.0.js"></script>
    <script src="../js boostrap/bootstrap.bundle.js"></script>
  </head>
  <body>
    <div class="main container">
      <h1>會員登入</h1>
      <div class="loginBtn">
        <button id="login">登入</button>
        <button id="register">註冊</button>
        <div style="background-color: rgb(187, 186, 186); height: 2px;  width: 406px; margin-left: 47px;">
        <div id="x" style="background-color: rgb(190, 82, 82);height: 2px; width: 203px ; transform: translateX(0px); transition: 0.3s;"></div></div>
      </div>

      <!-- 登入區 -->
      <div class="row">
       <div class="col-2"></div>
       <div class="uidName col-8" style="text-align: left">
        <form action="" name="form">
          <div class="">
            <label for="uid">帳號</label><br />
            <input
            class="uidPass"
              type="text"
              name="uid"
              id="uid"
              placeholder="請輸入手機號碼或信箱"
              required
            />
          </div>
          <div class="">
            <label for="passWord">密碼</label><br />
            <input type="password" name="" id="passWord"class="uidPass" />
          </div>
          <div class="row">
            <div class="col-4"></div>
            <div class="col-4 ms-lg-5"><input type="button" class="btn btn-danger mt-5" value="登入" id="submit1"></input></div>
            <div class="col-4"></div>
          </div>
        </form>
       </div>
       <div class="col-2"></div>
      
      </div>


      <!-- 註冊區 -->
      <div class="row">
        <div class="col-2"></div>
        <div class="uidName1 col-8"  style="text-align: left">
         <form action="" id="form" >
           <div class="">
             <label for="uid"><span >*</span> 帳號</label><br />
             <input
             class="uidPass1"
               type="email"
               id="uid1"
               name="email"
               placeholder="請輸入您的信箱"
               required
             />
          </div>
          <div class="">
            <label for="passWord"><span>*</span>密碼</label><br />
            <input type="password" name="passWord"  id="email"class="uidPass1" placeholder="請輸入您的密碼" required/>
          </div> 
          <div class="">
            <label for="passWord"><span>*</span>暱稱</label><br />
            <input type="text" name="userName"  id="userName"class="uidPass1" placeholder="請輸入您的暱稱" required/>
          </div> 
          <div class="">
            <label for="passWord"><span>*</span>地址</label><br />
            <input type="text" name="address"  id="address"class="uidPass1" placeholder="請輸入您的地址" required/>
          </div> 
          <div class="">
            <label for="passWord"><span>*</span>電話</label><br />
            <input type="tel" name="tel"  id="tel"class="uidPass1" placeholder="請輸入您的電話" required/>
          </div> 
          <div class="">
            <label for="passWord"><span>*</span>生日</label><br />
            <input type="date" name="date"  id="date"class="uidPass1"  required/>
          </div> 
          <div class="row">
            <div class="col-6"><label for=""><span>*</span>驗證碼:</label><input type="text" id="verify" class="uidPass1" required pattern="{6}"></div>
            <div class="col-6"><br> <input type="button" class="btn w-50" name="" id="send" value="寄送驗證碼" "></div>
          </div>
          <div class="row">
            <div class="col-4"></div>
            <div class="col-4 ms-lg-5"><input type="button" class="btn btn-danger mt-5" value="註冊" id="btnRegister"></input></div>
            <div class="col-4"></div>
          </div>
          <br>
         </form>
       </div>
       <div class="col-2"></div>
       <br>
        <div class="box">
          <span class="line"></span>
          <span class="txt">快速登入</span>
          <span class="line"></span>
        </div>
        
        <div class="row">
          <div class="col-2"></div>
          <div class="col-4"><button class="btn">google登入</button></div>
          <div class="col-4"><button class="btn">facebook登入</button></div>
          <div class="col-2"></div>
        </div>
      </div>
    <script>
      $(function () {
        // 登入區
        $("#login").on("click", function () {
          $("#login").css({
            color: "rgb(207, 57, 57)",
          });
          $("#register").css({
            color: "rgb(0,0,0)",
          });
          $('#x').css('transform','translateX(0px)')
          $(".uidName").css('display','block')
          $(".uidName1").css('display','none')
          $('h1').text('會員登入')
        });
        // 註冊區
        $("#register").on("click", function () {
          $("#login").css({
            color: "rgb(0,0,0)",
          });
          $("#register").css({
            color: "rgb(207, 57, 57)",
          });
          $('#x').css('transform','translateX(203px)')
          
          $(".uidName").css('display','none')
          $(".uidName1").css('display','block')
          

          $('h1').text('會員註冊')
        });
        // var form = document.forms['form1']
        // // submit.onclick =function  (){
        // // alert (uid.value)}
        // // 從表單裡抓input資料
        // var dataUid = form1.uid.value

        // 登入區
      submit1.onclick = ()=>{
      $.ajax({
        method:'get',
        url: "http://localhost:8000/test",
        // success傳輸成功後 回調函式 data是回傳的陣列
        success:(data)=>{
          let flag = false
          // 登入判斷
          data.forEach((val,i)=>{
          if(val.email == $('#uid').val() && val.password == $("#passWord").val()){
            alert('登入成功')
            window.location.href='https://www.google.com.tw/'
            flag =true
          }
          // 抓資料庫所有資料判斷
        })
        if(!flag){
          alert('登入失敗')}
          // 資料庫抓不到使用者輸入資料則報錯
        },

        error:() =>{
          alert('失敗')
        }
        // 傳輸不成功顯示失敗
        
      })
    }


    let code =''
    // 寄送驗證碼區
    send.onclick = () => {
      $('#send').val('重新發送驗證碼')
      let num = ['1','2','3','4','5','6','7','8','9','0','A','B','C','D','E','F','G','H','J','K','L','Q','W','R','T','Y','U','I','O','P','Z','X','V','N','M']
      
      for(let i = 0 ; i<6;i++){
        let random = Math.floor(Math.random()*32)
         code += num[random]
      }
      var data = {
        service_id: "service_emqvzdq",
        template_id: "template_kjmfnj3",
        user_id: "v--zvmBBJMdx7fndE",
        template_params: {
          to_name: $("#uid1").val(),
          from_name: "遊戲平台",
          email: $("#uid1").val(),
          num:code
        },
      };

      $.ajax("https://api.emailjs.com/api/v1.0/email/send", {
        type: "POST",
        data: JSON.stringify(data),
        contentType: "application/json",
      })
        .done(function () {
          alert("驗證碼已寄送");
        })
        .fail(function (error) {
          alert('伺服器忙碌中.. 請稍後再試');
        });
      return false;
    };
    
     


// 註冊區
      btnRegister.onclick = function () {
       
      let data = $('#form').serializeArray()
      console.log(data)
      let JSONdata = JSON.parse(serializeToJSON(data)) 
      // 抓使用者輸入資料 存到物件
      // serializeToJSON(data) 參考下面函式
     
      if($("#form")[0].reportValidity()&&$('#verify').val() == code){
       
         $.ajax({
           method: "post",
           url: "http://localhost:8000/test",
           data: JSONdata,
           // 要傳送的資料 
           success: function (data) {
           // console.log(data.data[0].job);
           // data.data.forEach((element, i) => {
           //   console.log(element);
           // });
           if(data){
             alert('信箱重複註冊')
           }
           else{
           alert('註冊成功')
           location.reload()}
           },
        // 傳輸成功跳出註冊成功
           error: function () {
           alert("伺服器忙碌中... 請稍後再試1");},
               //資料傳送失敗後就會執行這個function內的程式，可以在這裡寫入要執行的程式
             })
           }
           else if ($('#verify').val() != code){
               // 沒通過驗證
               alert('驗證碼錯誤')
             }
           else{
             alert('資料填寫錯誤') }
           };
             });

      // 轉表單資料的函式
      function serializeToJSON(data) {
        var values = {};
        // 宣告一個物件
        // for (index in data) {
        //   values[data[index].name] = data[index].value;
        //   // values[key]=value  物件新增屬性的方法
        // }
        data.forEach((val,i)=>{
          values[val.name] = val.value
        })
        return JSON.stringify(values);
        //     回傳迴圈跑完的值轉成JSON字串
      }
    </script>
  </body> 
</html>